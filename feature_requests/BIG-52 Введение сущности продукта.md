#Проблема

В настоящий момент все данные привязаны к сущности user_id. Это работает в текущем состоянии, но в перспективе может ограничивать возможности развития.

#Решение

Необходимо ввести новую сущность product, которая встроится в модель данных следующим образом:

1. Все существующие данные будут привязываться не к user, а к product, по тем же правилам, что и сейчас.
2. user и product связаны между собой отношением один-ко-многим

Задачу следует решать по шагам, каждый из которых допускает откат к предыдущему:

1. Создать в БД сущность (таблицу) products, где его ID будет первичным ключом.
2. Добавить во все колонки, где есть user_id, колонку product_id.

Провести первую миграцию данных (одноразовая процедура):

3. Создать для каждого пользователя по одной записи в таблице products с каким-то дефолтным продуктом
4. Заполнить колонки product_id в таблицах с существующими записями в соответствии с уже имеющимся в этих записях user_id

Заложить процессную основу:

5. Убедиться, что для каждого вновь создаваемого пользователя (при регистрации или при создании первой записи в любой из таблиц) будет генерироваться строчка в products с дефолтным продуктом.

Изменения в коде:

6. Заменить во всех запросах на чтение, изменение, удаление данных ключ на product_id
7. Изменить политики так, чтобы сверка проводилась не просто по текущему user_id, а по user_id, соответствующему product_id

Закрытие старенького:
8. Удалить из всех таблиц с данными колонку user_id
