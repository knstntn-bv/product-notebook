# Техническое задание: Альтернативная вёрстка и редактирование гипотез

## 1. Общая информация

### 1.1. Наименование
Альтернативная вёрстка гипотез с переходом на диалоговое редактирование

### 1.2. Цель
Улучшить UX редактирования гипотез: убрать inline-редактирование, использовать диалог (как для целей и фич), оптимизировать отображение в таблице.

### 1.3. Проблема
- Inline-редактирование неудобно
- Риск потери правок при отсутствии явного сохранения
- Неоптимальная структура отображения полей

---

## 2. Функциональные требования

### 2.1. Редактирование через диалог

#### 2.1.1. Компонент диалога
- Использовать `EntityDialog` (как для целей и фич)
- Диалог открывается по клику на строку гипотезы или кнопку редактирования
- В диалоге редактируются все поля гипотезы:
  - Status (Select)
  - Insight (Input/Textarea)
  - Problem Hypothesis (Textarea)
  - Problem Validation (Textarea)
  - Solution Hypothesis (Textarea)
  - Solution Validation (Textarea)
  - Impact Metrics (MetricTagInput)

#### 2.1.2. Сохранение изменений
- Кнопка "Save" в диалоге сохраняет все изменения
- При закрытии диалога без сохранения показывать предупреждение (если есть изменения)
- После сохранения диалог закрывается, таблица обновляется

#### 2.1.3. Создание новой гипотезы
- Кнопка "Add Hypothesis" открывает диалог с пустыми полями
- После сохранения создаётся новая запись

### 2.2. Изменение структуры таблицы

#### 2.2.1. Удаление inline-редактирования
- Убрать `AutoResizeTextarea` из ячеек таблицы
- Убрать кнопку "Save" из колонки Actions
- Убрать состояние `editedHypotheses` и связанную логику

#### 2.2.2. Отображение контента (только чтение)
- Ячейки таблицы только для отображения
- Клик по строке открывает диалог редактирования
- Поддержка переноса текста и корректного отображения длинных значений

#### 2.2.3. Реорганизация колонок

**Вариант 1: Объединение связанных полей** (выбран для реализации)
- Колонка "Problem Hypothesis" объединяет:
  - Проблемная гипотеза (основной текст)
  - Валидация проблемы (ниже, визуально отделена)
- Колонка "Solution Hypothesis" объединяет:
  - Гипотеза решения (основной текст)
  - Валидация решения (ниже, визуально отделена)

Вариант 2: Вертикальный стек с drag-and-drop
- Поля отображаются вертикально в одной колонке
- Возможность перетаскивания для изменения порядка
- Использовать `@dnd-kit` (как на BoardPage и RoadmapPage)

Рекомендация: начать с Варианта 1, при необходимости добавить Вариант 2.

### 2.3. Функциональность в таблице

#### 2.3.1. Изменение статуса
- Оставить Select для статуса в таблице
- Изменение статуса сохраняется сразу (без диалога)
- Или перенести изменение статуса в диалог (на усмотрение)

#### 2.3.2. Генерация фичи
- Кнопка "Create Feature" остаётся в колонке Actions
- При клике открывается диалог создания фичи (как сейчас)
- Логика без изменений

#### 2.3.3. Удаление гипотезы
- Кнопка удаления в диалоге (как для целей и фич)
- Подтверждение через `AlertDialog`

---

## 3. Технические требования

### 3.1. Компоненты и структура

#### 3.1.1. Модификация `HypothesesPage.tsx`
- Удалить:
  - `editedHypotheses` state
  - `handleFieldChange`
  - `handleSave`
  - `getHypothesisValue`
  - `hasUnsavedChanges`
  - Inline-редактирование в ячейках таблицы
- Добавить:
  - `editingHypothesis` state (аналогично `editingGoal` в RoadmapPage)
  - `isDialogOpen` state
  - `deleteAlertOpen` state
  - Обработчики открытия/закрытия диалога
  - Обработчик сохранения через диалог

#### 3.1.2. Использование `EntityDialog`
- Интегрировать `EntityDialog` для редактирования гипотез
- Настроить пропсы: `onSave`, `onDelete`, `isEditing`, `saveLabel`
- Добавить `AlertDialog` для подтверждения удаления

#### 3.1.3. Структура таблицы
- Изменить `TableHead` и `TableCell` для новой структуры колонок
- Реализовать отображение объединённых полей (проблема + валидация, решение + валидация)
- Добавить визуальное разделение между основным полем и валидацией (например, разделитель или отступ)

### 3.2. Стилизация

#### 3.2.1. Отображение объединённых полей
- Основное поле: обычный стиль
- Валидация: меньший шрифт, приглушённый цвет, отступ сверху
- Пример структуры:
  ```
  [Основной текст проблемы]
  ──────────────────────────
  [Валидация проблемы]
  ```

#### 3.2.2. Адаптивность
- Сохранить поддержку мобильных устройств
- Диалог должен корректно отображаться на всех размерах экрана

### 3.3. Состояния и валидация

#### 3.3.1. Валидация полей
- Обязательные поля (если есть) должны быть помечены
- Валидация перед сохранением

#### 3.3.2. Обработка ошибок
- Обработка ошибок при сохранении через toast-уведомления
- Откат изменений при ошибке

---

## 4. Пользовательские сценарии

### 4.1. Редактирование существующей гипотезы
1. Пользователь кликает на строку гипотезы в таблице
2. Открывается диалог с текущими данными
3. Пользователь вносит изменения
4. Нажимает "Save"
5. Изменения сохраняются, диалог закрывается, таблица обновляется

### 4.2. Создание новой гипотезы
1. Пользователь нажимает "Add Hypothesis"
2. Открывается диалог с пустыми полями
3. Заполняет поля
4. Нажимает "Save"
5. Создаётся новая гипотеза, диалог закрывается

### 4.3. Изменение статуса
1. Пользователь изменяет статус в Select таблицы
2. Изменение сохраняется автоматически (или через диалог)

### 4.4. Удаление гипотезы
1. Пользователь открывает диалог редактирования
2. Нажимает "Delete"
3. Появляется подтверждение
4. Подтверждает удаление
5. Гипотеза удаляется, диалог закрывается

---

## 5. Критерии приёмки

1. ✅ Редактирование гипотез происходит только через диалог
2. ✅ Inline-редактирование полностью удалено из таблицы
3. ✅ В таблице отображаются объединённые поля (проблема + валидация, решение + валидация)
4. ✅ Изменение статуса работает (в таблице или в диалоге)
5. ✅ Генерация фичи из гипотезы работает как раньше
6. ✅ Удаление гипотезы происходит через диалог с подтверждением
7. ✅ Нет риска потери данных при редактировании
8. ✅ Диалог корректно работает на всех размерах экрана
9. ✅ Сохранение изменений работает без ошибок
10. ✅ Код соответствует существующим паттернам (цели и фичи)

---

## 6. Дополнительные замечания

### 6.1. Опциональные улучшения
- Добавить drag-and-drop для изменения порядка полей (Вариант 2 из требований)
- Добавить автосохранение при редактировании в диалоге
- Добавить историю изменений гипотез

### 6.2. Совместимость
- Сохранить совместимость с существующими данными
- Миграция данных не требуется

---

## 7. Оценка сложности

- Рефакторинг редактирования: средняя
- Реорганизация таблицы: средняя
- Интеграция диалога: низкая (есть готовый компонент)
- Тестирование: средняя

Общая оценка: средняя сложность

---

Конец технического задания.

